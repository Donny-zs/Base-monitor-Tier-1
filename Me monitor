local component = require("component")
local term = require("term")

local refresh = 1  --время в секундах, через которое прозойдёт проверка МЕ системы
local interface = component.me_interface  
local chatbox = component.chat_box
Cpus = interface.getCpus()
CpusMem = interface.getCpus()

component.gpu.setResolution(8,5)
term.clear()
term.setCursor(1,1)
print("Текущее потребление МЕ:\n")

local function SayIfAeDone()
  Cpus=interface.getCpus()
  if (#Cpus = 1) or (Cpus == nil) then return false end
  for i=1,#Cpus do --кол-во циклов от 1 до кол-ва процессоров, i+1 каждый раз, так что каждый раз цикл говорит со следующим процессором
    if Cpus == nil then return false 
    else
      Cpus[i]["busy"] ~= CpusMem[i]["busy"] and Cpus[i]["busy"]==false 
      then chatbox.say("Ячейка крафта "..Cpus[i]["name"].." закончила работу")
    end
  end
  CpusMem=interface.getCpus()
end

local function AeEuConsumption()
  term.clearLine()
  local pow = interface.getAvgPowerInjection()
  if pow == nil then return false end
  pow = pow*0.5 -- конвертация из ае в еу
  term.write(math.floor(pow)) -- округление до целого
  term.write(" EU")
end

while true do
AeEuConsumption()
SayIfAeDone()
os.sleep(refresh)
end
